;; PgBouncer configuration for ESP32 Alarm System
;; Connection pooling for PostgreSQL database

[databases]
;; Database connection definition
;; Format: dbname = host=hostname port=port dbname=actualdb
esag-alarm-db = host=localhost port=5432 dbname=esag-alarm-db

;; For production with direct connections
;; esag-alarm-db-direct = host=localhost port=5432 dbname=esag-alarm-db pool_mode=session

[pgbouncer]
;; Connection settings
listen_addr = 127.0.0.1
listen_port = 6432
auth_type = md5
auth_file = users.txt

;; Pool settings
pool_mode = transaction
max_client_conn = 200
default_pool_size = 20
min_pool_size = 2
reserve_pool_size = 5
reserve_pool_timeout = 3
max_db_connections = 100
max_user_connections = 100

;; Timeout settings (in seconds)
server_idle_timeout = 600
server_lifetime = 3600
server_connect_timeout = 15
server_login_retry = 15
query_timeout = 0
query_wait_timeout = 120
client_idle_timeout = 0
client_login_timeout = 60

;; Connection handling
server_reset_query = DISCARD ALL
server_reset_query_always = 0
server_check_query = select 1
server_check_delay = 30

;; Resource limits
max_packet_size = 2147483647
pkt_buf = 4096
sbuf_loopcnt = 5
tcp_defer_accept = 0
tcp_socket_buffer = 0

;; Logging
logfile = pgbouncer.log
pidfile = pgbouncer.pid
admin_users = postgres
stats_users = postgres, pgbouncer
stats_period = 60
verbose = 0

;; Security
ignore_startup_parameters = extra_float_digits, options

;; Performance tuning
tcp_keepalive = 1
tcp_keepcnt = 3
tcp_keepidle = 60
tcp_keepintvl = 10
tcp_user_timeout = 0

;; DNS settings
dns_max_ttl = 15
dns_nxdomain_ttl = 15
dns_zone_check_period = 0

;; TLS settings (for production)
;; client_tls_sslmode = prefer
;; client_tls_ca_file = root.crt
;; client_tls_cert_file = server.crt
;; client_tls_key_file = server.key